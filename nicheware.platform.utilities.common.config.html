<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>nicheware.platform.utilities.common.config documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" type="text/css" href="css/tree.css" /></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">cljc-common</span> <span class="project-version">1.0.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="intro.html"><div class="inner"><span>Introduction</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nicheware</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>platform</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utilities</span></div></div></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></div></li><li class="depth-5 branch current"><a href="nicheware.platform.utilities.common.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-5 branch"><a href="nicheware.platform.utilities.common.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-5"><a href="nicheware.platform.utilities.common.graphics.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphics</span></div></a></li><li class="depth-6 branch"><a href="nicheware.platform.utilities.common.graphics.color.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>color</span></div></a></li><li class="depth-6 branch"><a href="nicheware.platform.utilities.common.graphics.interpolate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpolate</span></div></a></li><li class="depth-6"><a href="nicheware.platform.utilities.common.graphics.line.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>line</span></div></a></li><li class="depth-5 branch"><a href="nicheware.platform.utilities.common.math.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-5"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></div></li><li class="depth-6"><a href="nicheware.platform.utilities.common.state.migration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>migration</span></div></a></li><li class="depth-5"><a href="nicheware.platform.utilities.common.version.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>version</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="nicheware.platform.utilities.common.config.html#var-load-config"><div class="inner"><span>load-config</span></div></a></li><li class="depth-1"><a href="nicheware.platform.utilities.common.config.html#var-load-http-config"><div class="inner"><span>load-http-config</span></div></a></li><li class="depth-1"><a href="nicheware.platform.utilities.common.config.html#var-read-config"><div class="inner"><span>read-config</span></div></a></li><li class="depth-1"><a href="nicheware.platform.utilities.common.config.html#var-read-http-config"><div class="inner"><span>read-http-config</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">nicheware.platform.utilities.common.config</h1><div class="doc"><div class="markdown"><p>Supports reading application configuration as a clojure map.</p>
<p>Features include:</p>
<ul>
  <li>merging of a global config file, with an environment specific one (eg dev, test, prod)</li>
  <li>mustache variable substitution in config values. Variables are previously defined config values.</li>
  <li>mustache function operation on config value.</li>
  <li>optional parameters to override defaults.</li>
</ul>
<p>As an example, global configuration, common to every environment, could be defined in <code>resources/app/config.edn</code></p>
<pre><code class="clojure">{:env "default"
 :value "common-value"
 :file "{{env}}-file.txt"}
</code></pre>
<p>An environment specific config (eg for test) could be defined in <code>env/test/resources/app/env-config.edn</code>.</p>
<pre><code class="clojure">{:env "test"
 :other "value"}
</code></pre>
<p>When the execution environment is setup to include “resources” and “env/test/resources” on the classpath  (as would be done when executing tests), then calling <code>(load-config "app")</code> will return:</p>
<pre><code class="clojure">{:env "test"
 :other "value"
 :value "common-value"
 :file "test-file.txt"}
</code></pre>
<p>Variable evaluation is done recursively, on the final merged map until all variables have been evaluated.</p>
<p>Both <a href="nicheware.platform.utilities.common.config.html#var-load-config">load-config</a> and <a href="nicheware.platform.utilities.common.config.html#var-load-http-config">load-http-config</a> accept an optional opts map, which can selectively override  the following defaults:</p>
<pre><code class="clojure">{:env-file-name "env-config.edn"
 :common-file-name "config.edn"
 :resolve-vars true}
</code></pre>
<p>The opts arguments may also define <code>:common-path</code> or <code>:env-path</code>, which would then be used  instead of building up the path from the file name and provided path prefix.</p></div></div><div class="public anchor" id="var-load-config"><h3>load-config</h3><div class="usage"><code>(load-config config-path)</code><code>(load-config config-path opts)</code></div><div class="doc"><div class="markdown"><p>Loads config from the classpath, using the given path prefix for env and common files.</p>
<ul>
  <li>config-path: path prefix for both env and common file (eg <code>yourapp</code>)</li>
  <li>opts: optional override of default values <code>{:env-file-name :env-path :common-file-name :common-path :resolve-vars}</code></li>
  <li>Returns: a map which is a merge of the env and common config, optionally with all variables evualted.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/config.cljc#L131">view source</a></div></div><div class="public anchor" id="var-load-http-config"><h3>load-http-config</h3><div class="usage"><code>(load-http-config config-path)</code><code>(load-http-config config-path opts)</code></div><div class="doc"><div class="markdown"><p>Loads config from server, merging the current environment config with the base application configuration.</p>
<p>As the server instance represents the environment, it is up to the deployment build process to ensure the appropriate config.edn and env-config.edn is deployed, typically from <code>resources/public/&lt;app-prefix&gt;/config.edn</code> and <code>env/&lt;environment&gt;/resources/public/&lt;app-prefix&gt;/env-config.edn</code>.</p>
<ul>
  <li>config-path: eg <code>yourapp</code> will look for <code>/yourapp/config.edn</code> and <code>/yourapp/env-config.edn</code></li>
  <li>opts: optional override of default values <code>{:env-file-name :env-path :common-file-name :common-path :resolve-vars}</code></li>
  <li>returns: A promesa promise that resolves to the merged config map</li>
</ul></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/config.cljc#L161">view source</a></div></div><div class="public anchor" id="var-read-config"><h3>read-config</h3><div class="usage"><code>(read-config config-file-path)</code></div><div class="doc"><div class="markdown"><p>Reads a single config file from the classpath, returning as a clojure map.</p>
<ul>
  <li>config-file-path: eg <code>yourapp/config.edn</code></li>
  <li>returns: config file as clojure map.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/config.cljc#L114">view source</a></div></div><div class="public anchor" id="var-read-http-config"><h3>read-http-config</h3><div class="usage"><code>(read-http-config config-url)</code></div><div class="doc"><div class="markdown"><p>Reads via http from the default server location (usually resources/public) the specified config-file at the given path.</p>
<ul>
  <li>config-url: eg <code>yourapp/config.edn</code></li>
  <li>returns: a promesa promise that resolves to the map of config values read.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/config.cljc#L148">view source</a></div></div></div></body></html>