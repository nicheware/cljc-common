<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>nicheware.platform.utilities.common.state.migration documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" type="text/css" href="css/tree.css" /></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">cljc-common</span> <span class="project-version">1.0.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="intro.html"><div class="inner"><span>Introduction</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nicheware</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>platform</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utilities</span></div></div></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></div></li><li class="depth-5 branch"><a href="nicheware.platform.utilities.common.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-5 branch"><a href="nicheware.platform.utilities.common.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-5"><a href="nicheware.platform.utilities.common.graphics.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphics</span></div></a></li><li class="depth-6 branch"><a href="nicheware.platform.utilities.common.graphics.color.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>color</span></div></a></li><li class="depth-6 branch"><a href="nicheware.platform.utilities.common.graphics.interpolate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpolate</span></div></a></li><li class="depth-6"><a href="nicheware.platform.utilities.common.graphics.line.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>line</span></div></a></li><li class="depth-5 branch"><a href="nicheware.platform.utilities.common.math.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-5"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></div></li><li class="depth-6 current"><a href="nicheware.platform.utilities.common.state.migration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>migration</span></div></a></li><li class="depth-5"><a href="nicheware.platform.utilities.common.version.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>version</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="nicheware.platform.utilities.common.state.migration.html#var-could-upgrade-version"><div class="inner"><span>could-upgrade-version</span></div></a></li><li class="depth-1"><a href="nicheware.platform.utilities.common.state.migration.html#var-major-minor-version"><div class="inner"><span>major-minor-version</span></div></a></li><li class="depth-1"><a href="nicheware.platform.utilities.common.state.migration.html#var-major-version"><div class="inner"><span>major-version</span></div></a></li><li class="depth-1"><a href="nicheware.platform.utilities.common.state.migration.html#var-migrate-state"><div class="inner"><span>migrate-state</span></div></a></li><li class="depth-1"><a href="nicheware.platform.utilities.common.state.migration.html#var-minor-version"><div class="inner"><span>minor-version</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">nicheware.platform.utilities.common.state.migration</h1><div class="doc"><div class="markdown"><p>Functions used when handling migration of state, where state is represented by a Clojure map.</p>
<p>The functions within the migration namespace can be categorised as:</p>
<table>
  <thead>
    <tr>
      <th>Function group</th>
      <th>Functions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>helper functions</td>
      <td><a href="nicheware.platform.utilities.common.state.migration.html#var-major-version">major-version</a>, <a href="nicheware.platform.utilities.common.state.migration.html#var-minor-version">minor-version</a>, <a href="nicheware.platform.utilities.common.state.migration.html#var-major-minor-version">major-minor-version</a>, <a href="nicheware.platform.utilities.common.state.migration.html#var-could-upgrade-version">could-upgrade-version</a></td>
    </tr>
    <tr>
      <td>migration interface</td>
      <td><a href="nicheware.platform.utilities.common.state.migration.html#var-migrate-state">migrate-state</a></td>
    </tr>
  </tbody>
</table>
<p>The migration functions assume the state map contains a version attribute</p>
<pre><code class="clojure">  { :version "1.0.1"}
</code></pre>
<p>Some functions require a migration map which for each current version defines the migrations that are defined  to a later version.</p>
<pre><code class="clojure">  {"1.0"{:from-version "1.0"
           :to-version "1.1.0"
           :migration-fns [identity]}

   "1.1"{:from-version "1.1"
           :to-version "1.2.0"
           :migration-fns [add-effects/add-pattern-effects]}}
</code></pre>
<p>The <code>:migration-fns</code> attribute is a vector of functions that accept the old state map and return a newly migrated state map.</p></div></div><div class="public anchor" id="var-could-upgrade-version"><h3>could-upgrade-version</h3><div class="usage"><code>(could-upgrade-version first second)</code></div><div class="doc"><div class="markdown"><p>Test whether the first version is lower or equal to the second version. Just considers the major and minor versions, i.e. it is possible to upgrade.</p>
<p>The revision number (last digit) is not considered, as it is deemed not necessary to upgrade for revision changes only.</p>
<ul>
  <li>first: Version number of form’x.x.x’</li>
  <li>second: Version number of form’x.x.x’</li>
  <li>returns: True if possible to upgrade from first to second (i.e. first is less than or equal to second)</li>
</ul></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/state/migration.cljc#L75">view source</a></div></div><div class="public anchor" id="var-major-minor-version"><h3>major-minor-version</h3><div class="usage"><code>(major-minor-version version)</code></div><div class="doc"><div class="markdown"><p>Returns the major minor version string, removing any revision number (if present)</p>
<p>eg:</p>
<pre><code class="clojure">(major-minor-version "2.3.1") =&gt; "2.3"
(major-minor-version "1.1") =&gt; "1.1"
</code></pre></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/state/migration.cljc#L51">view source</a></div></div><div class="public anchor" id="var-major-version"><h3>major-version</h3><div class="usage"><code>(major-version version)</code></div><div class="doc"><div class="markdown"><p>Extracts the major version as an int from a version string of the form ‘x.x.x’</p>
<ul>
  <li>version: version number string of the form ‘x.x.x’ or ‘x.x’</li>
  <li>returns: The major version (first x) as an int. nil if not a valid version number.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/state/migration.cljc#L41">view source</a></div></div><div class="public anchor" id="var-migrate-state"><h3>migrate-state</h3><div class="usage"><code>(migrate-state {:keys [version], :as incoming-state} target-version migrations)</code></div><div class="doc"><div class="markdown"><p>Migrate state from its existing version to the goal version using the  supplied migration functions.</p>
<ul>
  <li>incoming-state: Current state including the version number. <code>{:version "1.2", ...}</code></li>
  <li>target-version: New version state should migrate to. eg <code>"1.3.1"</code></li>
  <li>migrations: Map defining migrations for different source and target versions. See below.</li>
  <li>returns: a new state map, upgraded to the target-version.</li>
</ul>
<p>migrations:</p>
<pre><code class="clojure">{&lt;source-migration-version&gt; {:from-version :to-version :migration-fns[]]}}
</code></pre>
<p><code>:migration-fns</code> is a vector of functions that when applied in order will accept a state map conforming to the <code>:from-version</code> state  schema, and will return a new state map conforming to the <code>:to-version</code> schema.</p>
<p>migrate-state will work out which migrations need to be applied to convert the state to the eventual target version.</p></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/state/migration.cljc#L97">view source</a></div></div><div class="public anchor" id="var-minor-version"><h3>minor-version</h3><div class="usage"><code>(minor-version version)</code></div><div class="doc"><div class="markdown"><p>Extracts the minor version as an int from a version string of the form ‘x.x.x’</p>
<ul>
  <li>version: version number string of the form ‘x.x.x’ or ‘x.x’</li>
  <li>returns: The minor version (second x) as an int. nil if not a valid version number.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/nicheware/cljc-common/blob/master/src/cljc/nicheware/platform/utilities/common/state/migration.cljc#L65">view source</a></div></div></div></body></html>